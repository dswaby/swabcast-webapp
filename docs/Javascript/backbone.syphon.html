<!DOCTYPE html>

<html>
<head>
  <title>backbone.syphon.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="SpecRunner.html">
                SpecRunner.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="dialog.html">
                dialog.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="revealoptions.html">
                revealoptions.js
              </a>
            
              
              <a class="source" href="localstorage.html">
                localstorage.js
              </a>
            
              
              <a class="source" href="alert_controller.html">
                alert_controller.js
              </a>
            
              
              <a class="source" href="alert_view.html">
                alert_view.js
              </a>
            
              
              <a class="source" href="edit_controller.html">
                edit_controller.js
              </a>
            
              
              <a class="source" href="edit_view.html">
                edit_view.js
              </a>
            
              
              <a class="source" href="episodes_app.html">
                episodes_app.js
              </a>
            
              
              <a class="source" href="feed_controller.html">
                feed_controller.js
              </a>
            
              
              <a class="source" href="feed_view.html">
                feed_view.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="nav_controller.html">
                nav_controller.js
              </a>
            
              
              <a class="source" href="nav_view.html">
                nav_view.js
              </a>
            
              
              <a class="source" href="new_view.html">
                new_view.js
              </a>
            
              
              <a class="source" href="player_controller.html">
                player_controller.js
              </a>
            
              
              <a class="source" href="player_view.html">
                player_view.js
              </a>
            
              
              <a class="source" href="playlist_controller.html">
                playlist_controller.js
              </a>
            
              
              <a class="source" href="playlist_view.html">
                playlist_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="FeedSpec.html">
                FeedSpec.js
              </a>
            
              
              <a class="source" href="async.html">
                async.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="subscriptions_app.html">
                subscriptions_app.js
              </a>
            
              
              <a class="source" href="build.html">
                build.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="view.html">
                view.js
              </a>
            
              
              <a class="source" href="views.html">
                views.js
              </a>
            
              
              <a class="source" href="episode.html">
                episode.js
              </a>
            
              
              <a class="source" href="feed.html">
                feed.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
              
              <a class="source" href="playlist.html">
                playlist.js
              </a>
            
              
              <a class="source" href="subscriptions.html">
                subscriptions.js
              </a>
            
              
              <a class="source" href="topics.html">
                topics.js
              </a>
            
              
              <a class="source" href="require_main.html">
                require_main.js
              </a>
            
              
              <a class="source" href="require_main_built.html">
                require_main_built.js
              </a>
            
              
              <a class="source" href="almond.html">
                almond.js
              </a>
            
              
              <a class="source" href="backbone.babysitter.html">
                backbone.babysitter.js
              </a>
            
              
              <a class="source" href="backbone.html">
                backbone.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.html">
                backbone.localstorage.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.min.html">
                backbone.localstorage.min.js
              </a>
            
              
              <a class="source" href="backbone.marionette.html">
                backbone.marionette.js
              </a>
            
              
              <a class="source" href="backbone.marionette.min.html">
                backbone.marionette.min.js
              </a>
            
              
              <a class="source" href="backbone.picky.html">
                backbone.picky.js
              </a>
            
              
              <a class="source" href="backbone.syphon.html">
                backbone.syphon.js
              </a>
            
              
              <a class="source" href="backbone.wreqr.html">
                backbone.wreqr.js
              </a>
            
              
              <a class="source" href="foundation.fastclick.html">
                foundation.fastclick.js
              </a>
            
              
              <a class="source" href="foundation.html">
                foundation.js
              </a>
            
              
              <a class="source" href="foundation.min.html">
                foundation.min.js
              </a>
            
              
              <a class="source" href="foundation.offcanvas.html">
                foundation.offcanvas.js
              </a>
            
              
              <a class="source" href="foundation.reveal.html">
                foundation.reveal.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jquery-ui-1.10.3.min.html">
                jquery-ui-1.10.3.min.js
              </a>
            
              
              <a class="source" href="jquery-ui.html">
                jquery-ui.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="jquery.transit.html">
                jquery.transit.js
              </a>
            
              
              <a class="source" href="jquery.transmit.html">
                jquery.transmit.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="log.html">
                log.js
              </a>
            
              
              <a class="source" href="modernizr.html">
                modernizr.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="jasmine-sinon.html">
                jasmine-sinon.js
              </a>
            
              
              <a class="source" href="sinon.html">
                sinon.js
              </a>
            
              
              <a class="source" href="spin.jquery.html">
                spin.jquery.js
              </a>
            
              
              <a class="source" href="spin.html">
                spin.js
              </a>
            
              
              <a class="source" href="tpl.html">
                tpl.js
              </a>
            
              
              <a class="source" href="underscore.html">
                underscore.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>backbone.syphon.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Backbone.Syphon, v0.4.1
Copyright (c)2012 Derick Bailey, Muted Solutions, LLC.
Distributed under MIT license
<a href="http://github.com/derickbailey/backbone.syphon">http://github.com/derickbailey/backbone.syphon</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Backbone, $, _)</span>{</span>
  <span class="hljs-keyword">var</span> Syphon = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="ignore-element-types">Ignore Element Types</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Tell Syphon to ignore all elements of these types. You can
push new types to ignore directly in to this array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Syphon.ignoredTypes = [<span class="hljs-string">"button"</span>, <span class="hljs-string">"submit"</span>, <span class="hljs-string">"reset"</span>, <span class="hljs-string">"fieldset"</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="syphon">Syphon</h2>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Get a JSON object that represents
all of the form inputs, in this view.
Alternately, pass a form element directly
in place of the view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Syphon.serialize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view, options)</span>{</span>
    <span class="hljs-keyword">var</span> data = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Build the configuration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> config = buildConfig(options);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get all of the elements to process</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> elements = getInputElements(view, config);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Process all of the elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(elements, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span>{</span>
      <span class="hljs-keyword">var</span> $el = $(el);
      <span class="hljs-keyword">var</span> type = getElementType($el);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Get the key for the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> keyExtractor = config.keyExtractors.get(type);
      <span class="hljs-keyword">var</span> key = keyExtractor($el);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Get the value for the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> inputReader = config.inputReaders.get(type);
      <span class="hljs-keyword">var</span> value = inputReader($el);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Get the key assignment validator and make sure
it’s valid before assigning the value to the key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> validKeyAssignment = config.keyAssignmentValidators.get(type);
      <span class="hljs-keyword">if</span> (validKeyAssignment($el, key, value)){
        <span class="hljs-keyword">var</span> keychain = config.keySplitter(key);
        data = assignKeyValue(data, keychain, value);
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Done; send back the results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> data;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Use the given JSON object to populate
all of the form inputs, in this view.
Alternately, pass a form element directly
in place of the view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Syphon.deserialize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view, data, options)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Build the configuration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> config = buildConfig(options);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Get all of the elements to process</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> elements = getInputElements(view, config);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Flatten the data structure that we are deserializing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> flattenedData = flattenData(config, data);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Process all of the elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(elements, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span>{</span>
      <span class="hljs-keyword">var</span> $el = $(el);
      <span class="hljs-keyword">var</span> type = getElementType($el);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Get the key for the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> keyExtractor = config.keyExtractors.get(type);
      <span class="hljs-keyword">var</span> key = keyExtractor($el);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Get the input writer and the value to write</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> inputWriter = config.inputWriters.get(type);
      <span class="hljs-keyword">var</span> value = flattenedData[key];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Write the value to the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      inputWriter($el, value);
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h2 id="helpers">Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Retrieve all of the form inputs
from the form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> getInputElements = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(view, config)</span>{</span>
    <span class="hljs-keyword">var</span> form = getForm(view);
    <span class="hljs-keyword">var</span> elements = form.elements;

    elements = _.reject(elements, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span>{</span>
      <span class="hljs-keyword">var</span> reject;
      <span class="hljs-keyword">var</span> type = getElementType(el);
      <span class="hljs-keyword">var</span> extractor = config.keyExtractors.get(type);
      <span class="hljs-keyword">var</span> identifier = extractor($(el));
     
      <span class="hljs-keyword">var</span> foundInIgnored = _.include(config.ignoredTypes, type);
      <span class="hljs-keyword">var</span> foundInInclude = _.include(config.include, identifier);
      <span class="hljs-keyword">var</span> foundInExclude = _.include(config.exclude, identifier);

      <span class="hljs-keyword">if</span> (foundInInclude){
        reject = <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (config.include){
          reject = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
          reject = (foundInExclude || foundInIgnored);
        }
      }

      <span class="hljs-keyword">return</span> reject;
    });

    <span class="hljs-keyword">return</span> elements;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Determine what type of element this is. It
will either return the <code>type</code> attribute of
an <code>&lt;input&gt;</code> element, or the <code>tagName</code> of
the element when the element is not an <code>&lt;input&gt;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> getElementType = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span>{</span>
    <span class="hljs-keyword">var</span> typeAttr;
    <span class="hljs-keyword">var</span> $el = $(el);
    <span class="hljs-keyword">var</span> tagName = $el[<span class="hljs-number">0</span>].tagName;
    <span class="hljs-keyword">var</span> type = tagName;

    <span class="hljs-keyword">if</span> (tagName.toLowerCase() === <span class="hljs-string">"input"</span>){
      typeAttr = $el.attr(<span class="hljs-string">"type"</span>);
      <span class="hljs-keyword">if</span> (typeAttr){
        type = typeAttr;
      } <span class="hljs-keyword">else</span> {
        type = <span class="hljs-string">"text"</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Always return the type as lowercase
so it can be matched to lowercase
type registrations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> type.toLowerCase();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>If a form element is given, just return it. 
Otherwise, get the form element from the view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> getForm = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(viewOrForm)</span>{</span>
    <span class="hljs-keyword">if</span> (_.isUndefined(viewOrForm.$el) &amp;&amp; viewOrForm.tagName.toLowerCase() === <span class="hljs-string">'form'</span>){
      <span class="hljs-keyword">return</span> viewOrForm;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> viewOrForm.$el.is(<span class="hljs-string">"form"</span>) ? viewOrForm.el : viewOrForm.$(<span class="hljs-string">"form"</span>)[<span class="hljs-number">0</span>];
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Build a configuration object and initialize
default values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> buildConfig = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span>{</span>
    <span class="hljs-keyword">var</span> config = _.clone(options) || {};
    
    config.ignoredTypes = _.clone(Syphon.ignoredTypes);
    config.inputReaders = config.inputReaders || Syphon.InputReaders;
    config.inputWriters = config.inputWriters || Syphon.InputWriters;
    config.keyExtractors = config.keyExtractors || Syphon.KeyExtractors;
    config.keySplitter = config.keySplitter || Syphon.KeySplitter;
    config.keyJoiner = config.keyJoiner || Syphon.KeyJoiner;
    config.keyAssignmentValidators = config.keyAssignmentValidators || Syphon.KeyAssignmentValidators;
    
    <span class="hljs-keyword">return</span> config;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Assigns <code>value</code> to a parsed JSON key. </p>
<p>The first parameter is the object which will be
modified to store the key/value pair.</p>
<p>The second parameter accepts an array of keys as a 
string with an option array containing a 
single string as the last option.</p>
<p>The third parameter is the value to be assigned.</p>
<p>Examples:</p>
<p><code>[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;] =&gt; {foo: {bar: {baz: &quot;value&quot;}}}</code></p>
<p><code>[&quot;foo&quot;, &quot;bar&quot;, [&quot;baz&quot;]] =&gt; {foo: {bar: {baz: [&quot;value&quot;]}}}</code></p>
<p>When the final value is an array with a string, the key
becomes an array, and values are pushed in to the array,
allowing multiple fields with the same name to be 
assigned to the array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> assignKeyValue = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, keychain, value)</span> {</span>
    <span class="hljs-keyword">if</span> (!keychain){ <span class="hljs-keyword">return</span> obj; }

    <span class="hljs-keyword">var</span> key = keychain.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>build the current object we need to store data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!obj[key]){
      obj[key] = _.isArray(key) ? [] : {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>if it’s the last key in the chain, assign the value directly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (keychain.length === <span class="hljs-number">0</span>){
      <span class="hljs-keyword">if</span> (_.isArray(obj[key])){
        obj[key].push(value);
      } <span class="hljs-keyword">else</span> {
        obj[key] = value;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>recursive parsing of the array, depth-first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (keychain.length &gt; <span class="hljs-number">0</span>){
      assignKeyValue(obj[key], keychain, value);
    }
    
    <span class="hljs-keyword">return</span> obj;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Flatten the data structure in to nested strings, using the
provided <code>KeyJoiner</code> function.</p>
<p>Example:</p>
<p>This input:</p>
<pre><code class="lang-js">{
  widget: <span class="hljs-string">"wombat"</span>,
  foo: {
    bar: <span class="hljs-string">"baz"</span>,
    baz: {
      quux: <span class="hljs-string">"qux"</span>
    },
    quux: [<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>]
  }
}
</code></pre>
<p>With a KeyJoiner that uses [ ] square brackets, 
should produce this output:</p>
<pre><code class="lang-js">{
 <span class="hljs-string">"widget"</span>: <span class="hljs-string">"wombat"</span>,
 <span class="hljs-string">"foo[bar]"</span>: <span class="hljs-string">"baz"</span>,
 <span class="hljs-string">"foo[baz][quux]"</span>: <span class="hljs-string">"qux"</span>,
 <span class="hljs-string">"foo[quux]"</span>: [<span class="hljs-string">"foo"</span>, <span class="hljs-string">"bar"</span>]
}
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> flattenData = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(config, data, parentKey)</span>{</span>
    <span class="hljs-keyword">var</span> flatData = {};

    _.each(data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, keyName)</span>{</span>
      <span class="hljs-keyword">var</span> hash = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>If there is a parent key, join it with
the current, child key.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (parentKey){
        keyName = config.keyJoiner(parentKey, keyName);
      }

      <span class="hljs-keyword">if</span> (_.isArray(value)){
        keyName += <span class="hljs-string">"[]"</span>;
        hash[keyName] = value;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(value)){
        hash = flattenData(config, value, keyName);
      } <span class="hljs-keyword">else</span> {
        hash[keyName] = value;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Store the resulting key/value pairs in the
final flattened data object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.extend(flatData, hash);
    });

    <span class="hljs-keyword">return</span> flatData;
  };

  <span class="hljs-keyword">return</span> Syphon;
})(Backbone, jQuery, _);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="type-registry">Type Registry</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Type Registries allow you to register something to
an input type, and retrieve either the item registered
for a specific type or the default registration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.TypeRegistry = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  <span class="hljs-keyword">this</span>.registeredTypes = {};
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Borrow Backbone’s <code>extend</code> keyword for our TypeRegistry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.TypeRegistry.extend = Backbone.Model.extend;

_.extend(Backbone.Syphon.TypeRegistry.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Get the registered item by type. If nothing is
found for the specified type, the default is
returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type)</span>{</span>
    <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">this</span>.registeredTypes[type];

    <span class="hljs-keyword">if</span> (!item){
      item = <span class="hljs-keyword">this</span>.registeredTypes[<span class="hljs-string">"default"</span>];
    }

    <span class="hljs-keyword">return</span> item;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Register a new item for a specified type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  register: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, item)</span>{</span>
    <span class="hljs-keyword">this</span>.registeredTypes[type] = item;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Register a default item to be used when no
item for a specified type is found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  registerDefault: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item)</span>{</span>
    <span class="hljs-keyword">this</span>.registeredTypes[<span class="hljs-string">"default"</span>] = item;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Remove an item from a given type registration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unregister: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type)</span>{</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.registeredTypes[type]){
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.registeredTypes[type];
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="key-extractors">Key Extractors</h2>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Key extractors produce the “key” in <code>{key: &quot;value&quot;}</code>
pairs, when serializing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyExtractorSet = Backbone.Syphon.TypeRegistry.extend();</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Built-in Key Extractors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyExtractors = <span class="hljs-keyword">new</span> Backbone.Syphon.KeyExtractorSet();</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>The default key extractor, which uses the
input element’s “id” attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyExtractors.registerDefault(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el)</span>{</span>
  <span class="hljs-keyword">return</span> $el.prop(<span class="hljs-string">"name"</span>);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2 id="input-readers">Input Readers</h2>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Input Readers are used to extract the value from
an input element, for the serialized object result</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputReaderSet = Backbone.Syphon.TypeRegistry.extend();</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Built-in Input Readers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputReaders = <span class="hljs-keyword">new</span> Backbone.Syphon.InputReaderSet();</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>The default input reader, which uses an input
element’s “value”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputReaders.registerDefault(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el)</span>{</span>
  <span class="hljs-keyword">return</span> $el.val();
});</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Checkbox reader, returning a boolean value for
whether or not the checkbox is checked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputReaders.register(<span class="hljs-string">"checkbox"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el)</span>{</span>
  <span class="hljs-keyword">var</span> checked = $el.prop(<span class="hljs-string">"checked"</span>);
  <span class="hljs-keyword">return</span> checked;
});</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h2 id="input-writers">Input Writers</h2>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Input Writers are used to insert a value from an
object into an input element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputWriterSet = Backbone.Syphon.TypeRegistry.extend();</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Built-in Input Writers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputWriters = <span class="hljs-keyword">new</span> Backbone.Syphon.InputWriterSet();</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>The default input writer, which sets an input
element’s “value”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputWriters.registerDefault(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el, value)</span>{</span>
  $el.val(value);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Checkbox writer, set whether or not the checkbox is checked
depending on the boolean value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputWriters.register(<span class="hljs-string">"checkbox"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el, value)</span>{</span>
  $el.prop(<span class="hljs-string">"checked"</span>, value);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Radio button writer, set whether or not the radio button is
checked.  The button should only be checked if it’s value
equals the given value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.InputWriters.register(<span class="hljs-string">"radio"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el, value)</span>{</span>
  $el.prop(<span class="hljs-string">"checked"</span>, $el.val() === value);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <h2 id="key-assignment-validators">Key Assignment Validators</h2>

            </div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Key Assignment Validators are used to determine whether or not a
key should be assigned to a value, after the key and value have been
extracted from the element. This is the last opportunity to prevent
bad data from getting serialized to your object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Backbone.Syphon.KeyAssignmentValidatorSet = Backbone.Syphon.TypeRegistry.extend();</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Build-in Key Assignment Validators</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyAssignmentValidators = <span class="hljs-keyword">new</span> Backbone.Syphon.KeyAssignmentValidatorSet();</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Everything is valid by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyAssignmentValidators.registerDefault(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; });</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>But only the “checked” radio button for a given
radio button group is valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeyAssignmentValidators.register(<span class="hljs-string">"radio"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($el, key, value)</span>{</span> 
  <span class="hljs-keyword">return</span> $el.prop(<span class="hljs-string">"checked"</span>);
});</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h2 id="backbone-syphon-keysplitter">Backbone.Syphon.KeySplitter</h2>

            </div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>This function is used to split DOM element keys in to an array
of parts, which are then used to create a nested result structure.
returning <code>[&quot;foo&quot;, &quot;bar&quot;]</code> results in <code>{foo: { bar: &quot;value&quot; }}</code>.</p>
<p>Override this method to use a custom key splitter, such as:
<code>&lt;input name=&quot;foo.bar.baz&quot;&gt;</code>, <code>return key.split(&quot;.&quot;)</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backbone.Syphon.KeySplitter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span>{</span>
  <span class="hljs-keyword">var</span> matches = key.match(<span class="hljs-regexp">/[^\[\]]+/g</span>);

  <span class="hljs-keyword">if</span> (key.indexOf(<span class="hljs-string">"[]"</span>) === key.length - <span class="hljs-number">2</span>){
    lastKey = matches.pop();
    matches.push([lastKey]);
  }

  <span class="hljs-keyword">return</span> matches;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h2 id="backbone-syphon-keyjoiner">Backbone.Syphon.KeyJoiner</h2>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Take two segments of a key and join them together, to create the
de-normalized key name, when deserializing a data structure back
in to a form.</p>
<p>Example: </p>
<p>With this data strucutre <code>{foo: { bar: {baz: &quot;value&quot;, quux: &quot;another&quot;} } }</code>,
the key joiner will be called with these parameters, and assuming the
join happens with “[ ]” square brackets, the specified output:</p>
<p><code>KeyJoiner(&quot;foo&quot;, &quot;bar&quot;)</code> //=&gt; “foo[bar]”
<code>KeyJoiner(&quot;foo[bar]&quot;, &quot;baz&quot;)</code> //=&gt; “foo[bar][baz]”
<code>KeyJoiner(&quot;foo[bar]&quot;, &quot;quux&quot;)</code> //=&gt; “foo[bar][quux]”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
Backbone.Syphon.KeyJoiner = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parentKey, childKey)</span>{</span>
  <span class="hljs-keyword">return</span> parentKey + <span class="hljs-string">"["</span> + childKey + <span class="hljs-string">"]"</span>;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
