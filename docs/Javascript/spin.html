<!DOCTYPE html>

<html>
<head>
  <title>spin.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="SpecRunner.html">
                SpecRunner.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="dialog.html">
                dialog.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="revealoptions.html">
                revealoptions.js
              </a>
            
              
              <a class="source" href="localstorage.html">
                localstorage.js
              </a>
            
              
              <a class="source" href="alert_controller.html">
                alert_controller.js
              </a>
            
              
              <a class="source" href="alert_view.html">
                alert_view.js
              </a>
            
              
              <a class="source" href="edit_controller.html">
                edit_controller.js
              </a>
            
              
              <a class="source" href="edit_view.html">
                edit_view.js
              </a>
            
              
              <a class="source" href="episodes_app.html">
                episodes_app.js
              </a>
            
              
              <a class="source" href="feed_controller.html">
                feed_controller.js
              </a>
            
              
              <a class="source" href="feed_view.html">
                feed_view.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="nav_controller.html">
                nav_controller.js
              </a>
            
              
              <a class="source" href="nav_view.html">
                nav_view.js
              </a>
            
              
              <a class="source" href="new_view.html">
                new_view.js
              </a>
            
              
              <a class="source" href="player_controller.html">
                player_controller.js
              </a>
            
              
              <a class="source" href="player_view.html">
                player_view.js
              </a>
            
              
              <a class="source" href="playlist_controller.html">
                playlist_controller.js
              </a>
            
              
              <a class="source" href="playlist_view.html">
                playlist_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="FeedSpec.html">
                FeedSpec.js
              </a>
            
              
              <a class="source" href="async.html">
                async.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="subscriptions_app.html">
                subscriptions_app.js
              </a>
            
              
              <a class="source" href="build.html">
                build.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="view.html">
                view.js
              </a>
            
              
              <a class="source" href="views.html">
                views.js
              </a>
            
              
              <a class="source" href="episode.html">
                episode.js
              </a>
            
              
              <a class="source" href="feed.html">
                feed.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
              
              <a class="source" href="playlist.html">
                playlist.js
              </a>
            
              
              <a class="source" href="subscriptions.html">
                subscriptions.js
              </a>
            
              
              <a class="source" href="topics.html">
                topics.js
              </a>
            
              
              <a class="source" href="require_main.html">
                require_main.js
              </a>
            
              
              <a class="source" href="require_main_built.html">
                require_main_built.js
              </a>
            
              
              <a class="source" href="almond.html">
                almond.js
              </a>
            
              
              <a class="source" href="backbone.babysitter.html">
                backbone.babysitter.js
              </a>
            
              
              <a class="source" href="backbone.html">
                backbone.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.html">
                backbone.localstorage.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.min.html">
                backbone.localstorage.min.js
              </a>
            
              
              <a class="source" href="backbone.marionette.html">
                backbone.marionette.js
              </a>
            
              
              <a class="source" href="backbone.marionette.min.html">
                backbone.marionette.min.js
              </a>
            
              
              <a class="source" href="backbone.picky.html">
                backbone.picky.js
              </a>
            
              
              <a class="source" href="backbone.syphon.html">
                backbone.syphon.js
              </a>
            
              
              <a class="source" href="backbone.wreqr.html">
                backbone.wreqr.js
              </a>
            
              
              <a class="source" href="foundation.fastclick.html">
                foundation.fastclick.js
              </a>
            
              
              <a class="source" href="foundation.html">
                foundation.js
              </a>
            
              
              <a class="source" href="foundation.min.html">
                foundation.min.js
              </a>
            
              
              <a class="source" href="foundation.offcanvas.html">
                foundation.offcanvas.js
              </a>
            
              
              <a class="source" href="foundation.reveal.html">
                foundation.reveal.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jquery-ui-1.10.3.min.html">
                jquery-ui-1.10.3.min.js
              </a>
            
              
              <a class="source" href="jquery-ui.html">
                jquery-ui.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="jquery.transit.html">
                jquery.transit.js
              </a>
            
              
              <a class="source" href="jquery.transmit.html">
                jquery.transmit.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="log.html">
                log.js
              </a>
            
              
              <a class="source" href="modernizr.html">
                modernizr.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="jasmine-sinon.html">
                jasmine-sinon.js
              </a>
            
              
              <a class="source" href="sinon.html">
                sinon.js
              </a>
            
              
              <a class="source" href="spin.jquery.html">
                spin.jquery.js
              </a>
            
              
              <a class="source" href="spin.html">
                spin.js
              </a>
            
              
              <a class="source" href="tpl.html">
                tpl.js
              </a>
            
              
              <a class="source" href="underscore.html">
                underscore.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>spin.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>fgnass.github.com/spin.js#v1.3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
 * Copyright (c) 2011-2013 Felix Gnass
 * Licensed under the MIT license
 */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(root, factory)</span> {</span>

  <span class="hljs-comment">/* CommonJS */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports == <span class="hljs-string">'object'</span>)  module.exports = factory()

  <span class="hljs-comment">/* AMD module */</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define == <span class="hljs-string">'function'</span> &amp;&amp; define.amd) define(factory)

  <span class="hljs-comment">/* Browser global */</span>
  <span class="hljs-keyword">else</span> root.Spinner = factory()
}
(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span class="hljs-pi">  "use strict"</span>;

  <span class="hljs-keyword">var</span> prefixes = [<span class="hljs-string">'webkit'</span>, <span class="hljs-string">'Moz'</span>, <span class="hljs-string">'ms'</span>, <span class="hljs-string">'O'</span>] <span class="hljs-comment">/* Vendor prefixes */</span>
    , animations = {} <span class="hljs-comment">/* Animation rules keyed by their name */</span>
    , useCssAnimations <span class="hljs-comment">/* Whether to use CSS animations or setTimeout */</span>

  <span class="hljs-comment">/**
   * Utility function to create elements. If no tag name is given,
   * a DIV is created. Optionally properties can be passed.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createEl</span><span class="hljs-params">(tag, prop)</span> {</span>
    <span class="hljs-keyword">var</span> el = document.createElement(tag || <span class="hljs-string">'div'</span>)
      , n

    <span class="hljs-keyword">for</span>(n <span class="hljs-keyword">in</span> prop) el[n] = prop[n]
    <span class="hljs-keyword">return</span> el
  }

  <span class="hljs-comment">/**
   * Appends children and returns the parent.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ins</span><span class="hljs-params">(parent <span class="hljs-comment">/* child1, child2, ...*/</span>)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">1</span>, n=<span class="hljs-built_in">arguments</span>.length; i&lt;n; i++)
      parent.appendChild(<span class="hljs-built_in">arguments</span>[i])

    <span class="hljs-keyword">return</span> parent
  }

  <span class="hljs-comment">/**
   * Insert a new stylesheet to hold the @keyframe or VML rules.
   */</span>
  <span class="hljs-keyword">var</span> sheet = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> el = createEl(<span class="hljs-string">'style'</span>, {type : <span class="hljs-string">'text/css'</span>})
    ins(document.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>], el)
    <span class="hljs-keyword">return</span> el.sheet || el.styleSheet
  }())

  <span class="hljs-comment">/**
   * Creates an opacity keyframe animation rule and returns its name.
   * Since most mobile Webkits have timing issues with animation-delay,
   * we create separate rules for each line/segment.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addAnimation</span><span class="hljs-params">(alpha, trail, i, lines)</span> {</span>
    <span class="hljs-keyword">var</span> name = [<span class="hljs-string">'opacity'</span>, trail, ~~(alpha*<span class="hljs-number">100</span>), i, lines].join(<span class="hljs-string">'-'</span>)
      , start = <span class="hljs-number">0.01</span> + i/lines * <span class="hljs-number">100</span>
      , z = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">1</span> - (<span class="hljs-number">1</span>-alpha) / trail * (<span class="hljs-number">100</span>-start), alpha)
      , prefix = useCssAnimations.substring(<span class="hljs-number">0</span>, useCssAnimations.indexOf(<span class="hljs-string">'Animation'</span>)).toLowerCase()
      , pre = prefix &amp;&amp; <span class="hljs-string">'-'</span> + prefix + <span class="hljs-string">'-'</span> || <span class="hljs-string">''</span>

    <span class="hljs-keyword">if</span> (!animations[name]) {
      sheet.insertRule(
        <span class="hljs-string">'@'</span> + pre + <span class="hljs-string">'keyframes '</span> + name + <span class="hljs-string">'{'</span> +
        <span class="hljs-string">'0%{opacity:'</span> + z + <span class="hljs-string">'}'</span> +
        start + <span class="hljs-string">'%{opacity:'</span> + alpha + <span class="hljs-string">'}'</span> +
        (start+<span class="hljs-number">0.01</span>) + <span class="hljs-string">'%{opacity:1}'</span> +
        (start+trail) % <span class="hljs-number">100</span> + <span class="hljs-string">'%{opacity:'</span> + alpha + <span class="hljs-string">'}'</span> +
        <span class="hljs-string">'100%{opacity:'</span> + z + <span class="hljs-string">'}'</span> +
        <span class="hljs-string">'}'</span>, sheet.cssRules.length)

      animations[name] = <span class="hljs-number">1</span>
    }

    <span class="hljs-keyword">return</span> name
  }

  <span class="hljs-comment">/**
   * Tries various vendor prefixes and returns the first supported property.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vendor</span><span class="hljs-params">(el, prop)</span> {</span>
    <span class="hljs-keyword">var</span> s = el.style
      , pp
      , i

    <span class="hljs-keyword">if</span>(s[prop] !== <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> prop
    prop = prop.charAt(<span class="hljs-number">0</span>).toUpperCase() + prop.slice(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;prefixes.length; i++) {
      pp = prefixes[i]+prop
      <span class="hljs-keyword">if</span>(s[pp] !== <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span> pp
    }
  }

  <span class="hljs-comment">/**
   * Sets multiple style properties at once.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">css</span><span class="hljs-params">(el, prop)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> prop)
      el.style[vendor(el, n)||n] = prop[n]

    <span class="hljs-keyword">return</span> el
  }

  <span class="hljs-comment">/**
   * Fills in default values.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merge</span><span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">1</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
      <span class="hljs-keyword">var</span> def = <span class="hljs-built_in">arguments</span>[i]
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n <span class="hljs-keyword">in</span> def)
        <span class="hljs-keyword">if</span> (obj[n] === <span class="hljs-literal">undefined</span>) obj[n] = def[n]
    }
    <span class="hljs-keyword">return</span> obj
  }

  <span class="hljs-comment">/**
   * Returns the absolute page-offset of the given element.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pos</span><span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">var</span> o = { x:el.offsetLeft, y:el.offsetTop }
    <span class="hljs-keyword">while</span>((el = el.offsetParent))
      o.x+=el.offsetLeft, o.y+=el.offsetTop

    <span class="hljs-keyword">return</span> o
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Built-in defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> defaults = {
    lines: <span class="hljs-number">12</span>,            <span class="hljs-comment">// The number of lines to draw</span>
    length: <span class="hljs-number">7</span>,            <span class="hljs-comment">// The length of each line</span>
    width: <span class="hljs-number">5</span>,             <span class="hljs-comment">// The line thickness</span>
    radius: <span class="hljs-number">10</span>,           <span class="hljs-comment">// The radius of the inner circle</span>
    rotate: <span class="hljs-number">0</span>,            <span class="hljs-comment">// Rotation offset</span>
    corners: <span class="hljs-number">1</span>,           <span class="hljs-comment">// Roundness (0..1)</span>
    color: <span class="hljs-string">'#000'</span>,        <span class="hljs-comment">// #rgb or #rrggbb</span>
    direction: <span class="hljs-number">1</span>,         <span class="hljs-comment">// 1: clockwise, -1: counterclockwise</span>
    speed: <span class="hljs-number">1</span>,             <span class="hljs-comment">// Rounds per second</span>
    trail: <span class="hljs-number">100</span>,           <span class="hljs-comment">// Afterglow percentage</span>
    opacity: <span class="hljs-number">1</span>/<span class="hljs-number">4</span>,         <span class="hljs-comment">// Opacity of the lines</span>
    fps: <span class="hljs-number">20</span>,              <span class="hljs-comment">// Frames per second when using setTimeout()</span>
    zIndex: <span class="hljs-number">2e9</span>,          <span class="hljs-comment">// Use a high z-index by default</span>
    className: <span class="hljs-string">'spinner'</span>, <span class="hljs-comment">// CSS class to assign to the element</span>
    top: <span class="hljs-string">'auto'</span>,          <span class="hljs-comment">// center vertically</span>
    left: <span class="hljs-string">'auto'</span>,         <span class="hljs-comment">// center horizontally</span>
    position: <span class="hljs-string">'relative'</span>  <span class="hljs-comment">// element position</span>
  }

  <span class="hljs-comment">/** The constructor */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Spinner</span><span class="hljs-params">(o)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span> == <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Spinner(o)
    <span class="hljs-keyword">this</span>.opts = merge(o || {}, Spinner.defaults, defaults)
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Global defaults that override the built-ins:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Spinner.defaults = {}

  merge(Spinner.prototype, {

    <span class="hljs-comment">/**
     * Adds the spinner to the given target element. If this instance is already
     * spinning, it is automatically removed from its previous target b calling
     * stop() internally.
     */</span>
    spin: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(target)</span> {</span>
      <span class="hljs-keyword">this</span>.stop()

      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
        , o = self.opts
        , el = self.el = css(createEl(<span class="hljs-number">0</span>, {className: o.className}), {position: o.position, width: <span class="hljs-number">0</span>, zIndex: o.zIndex})
        , mid = o.radius+o.length+o.width
        , ep <span class="hljs-comment">// element position</span>
        , tp <span class="hljs-comment">// target position</span>

      <span class="hljs-keyword">if</span> (target) {
        target.insertBefore(el, target.firstChild||<span class="hljs-literal">null</span>)
        tp = pos(target)
        ep = pos(el)
        css(el, {
          left: (o.left == <span class="hljs-string">'auto'</span> ? tp.x-ep.x + (target.offsetWidth &gt;&gt; <span class="hljs-number">1</span>) : <span class="hljs-built_in">parseInt</span>(o.left, <span class="hljs-number">10</span>) + mid) + <span class="hljs-string">'px'</span>,
          top: (o.top == <span class="hljs-string">'auto'</span> ? tp.y-ep.y + (target.offsetHeight &gt;&gt; <span class="hljs-number">1</span>) : <span class="hljs-built_in">parseInt</span>(o.top, <span class="hljs-number">10</span>) + mid)  + <span class="hljs-string">'px'</span>
        })
      }

      el.setAttribute(<span class="hljs-string">'role'</span>, <span class="hljs-string">'progressbar'</span>)
      self.lines(el, self.opts)

      <span class="hljs-keyword">if</span> (!useCssAnimations) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>No CSS animation support, use setTimeout() instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>
          , start = (o.lines - <span class="hljs-number">1</span>) * (<span class="hljs-number">1</span> - o.direction) / <span class="hljs-number">2</span>
          , alpha
          , fps = o.fps
          , f = fps/o.speed
          , ostep = (<span class="hljs-number">1</span>-o.opacity) / (f*o.trail / <span class="hljs-number">100</span>)
          , astep = f/o.lines

        ;(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">anim</span><span class="hljs-params">()</span> {</span>
          i++;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; o.lines; j++) {
            alpha = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">1</span> - (i + (o.lines - j) * astep) % f * ostep, o.opacity)

            self.opacity(el, j * o.direction + start, alpha, o)
          }
          self.timeout = self.el &amp;&amp; setTimeout(anim, ~~(<span class="hljs-number">1000</span>/fps))
        })()
      }
      <span class="hljs-keyword">return</span> self
    },

    <span class="hljs-comment">/**
     * Stops and removes the Spinner.
     */</span>
    stop: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.el
      <span class="hljs-keyword">if</span> (el) {
        clearTimeout(<span class="hljs-keyword">this</span>.timeout)
        <span class="hljs-keyword">if</span> (el.parentNode) el.parentNode.removeChild(el)
        <span class="hljs-keyword">this</span>.el = <span class="hljs-literal">undefined</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
    },

    <span class="hljs-comment">/**
     * Internal method that draws the individual lines. Will be overwritten
     * in VML fallback mode below.
     */</span>
    lines: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, o)</span> {</span>
      <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>
        , start = (o.lines - <span class="hljs-number">1</span>) * (<span class="hljs-number">1</span> - o.direction) / <span class="hljs-number">2</span>
        , seg

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fill</span><span class="hljs-params">(color, shadow)</span> {</span>
        <span class="hljs-keyword">return</span> css(createEl(), {
          position: <span class="hljs-string">'absolute'</span>,
          width: (o.length+o.width) + <span class="hljs-string">'px'</span>,
          height: o.width + <span class="hljs-string">'px'</span>,
          background: color,
          boxShadow: shadow,
          transformOrigin: <span class="hljs-string">'left'</span>,
          transform: <span class="hljs-string">'rotate('</span> + ~~(<span class="hljs-number">360</span>/o.lines*i+o.rotate) + <span class="hljs-string">'deg) translate('</span> + o.radius+<span class="hljs-string">'px'</span> +<span class="hljs-string">',0)'</span>,
          borderRadius: (o.corners * o.width&gt;&gt;<span class="hljs-number">1</span>) + <span class="hljs-string">'px'</span>
        })
      }

      <span class="hljs-keyword">for</span> (; i &lt; o.lines; i++) {
        seg = css(createEl(), {
          position: <span class="hljs-string">'absolute'</span>,
          top: <span class="hljs-number">1</span>+~(o.width/<span class="hljs-number">2</span>) + <span class="hljs-string">'px'</span>,
          transform: o.hwaccel ? <span class="hljs-string">'translate3d(0,0,0)'</span> : <span class="hljs-string">''</span>,
          opacity: o.opacity,
          animation: useCssAnimations &amp;&amp; addAnimation(o.opacity, o.trail, start + i * o.direction, o.lines) + <span class="hljs-string">' '</span> + <span class="hljs-number">1</span>/o.speed + <span class="hljs-string">'s linear infinite'</span>
        })

        <span class="hljs-keyword">if</span> (o.shadow) ins(seg, css(fill(<span class="hljs-string">'#000'</span>, <span class="hljs-string">'0 0 4px '</span> + <span class="hljs-string">'#000'</span>), {top: <span class="hljs-number">2</span>+<span class="hljs-string">'px'</span>}))

        ins(el, ins(seg, fill(o.color, <span class="hljs-string">'0 0 1px rgba(0,0,0,.1)'</span>)))
      }
      <span class="hljs-keyword">return</span> el
    },

    <span class="hljs-comment">/**
     * Internal method that adjusts the opacity of a single line.
     * Will be overwritten in VML fallback mode below.
     */</span>
    opacity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, val)</span> {</span>
      <span class="hljs-keyword">if</span> (i &lt; el.childNodes.length) el.childNodes[i].style.opacity = val
    }

  })


  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initVML</span><span class="hljs-params">()</span> {</span>

    <span class="hljs-comment">/* Utility function to create a VML tag */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vml</span><span class="hljs-params">(tag, attr)</span> {</span>
      <span class="hljs-keyword">return</span> createEl(<span class="hljs-string">'&lt;'</span> + tag + <span class="hljs-string">' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml"&gt;'</span>, attr)
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>No CSS transforms but VML support, add a CSS rule for VML elements:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sheet.addRule(<span class="hljs-string">'.spin-vml'</span>, <span class="hljs-string">'behavior:url(#default#VML)'</span>)

    Spinner.prototype.lines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, o)</span> {</span>
      <span class="hljs-keyword">var</span> r = o.length+o.width
        , s = <span class="hljs-number">2</span>*r

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">grp</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> css(
          vml(<span class="hljs-string">'group'</span>, {
            coordsize: s + <span class="hljs-string">' '</span> + s,
            coordorigin: -r + <span class="hljs-string">' '</span> + -r
          }),
          { width: s, height: s }
        )
      }

      <span class="hljs-keyword">var</span> margin = -(o.width+o.length)*<span class="hljs-number">2</span> + <span class="hljs-string">'px'</span>
        , g = css(grp(), {position: <span class="hljs-string">'absolute'</span>, top: margin, left: margin})
        , i

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seg</span><span class="hljs-params">(i, dx, filter)</span> {</span>
        ins(g,
          ins(css(grp(), {rotation: <span class="hljs-number">360</span> / o.lines * i + <span class="hljs-string">'deg'</span>, left: ~~dx}),
            ins(css(vml(<span class="hljs-string">'roundrect'</span>, {arcsize: o.corners}), {
                width: r,
                height: o.width,
                left: o.radius,
                top: -o.width&gt;&gt;<span class="hljs-number">1</span>,
                filter: filter
              }),
              vml(<span class="hljs-string">'fill'</span>, {color: o.color, opacity: o.opacity}),
              vml(<span class="hljs-string">'stroke'</span>, {opacity: <span class="hljs-number">0</span>}) <span class="hljs-comment">// transparent stroke to fix color bleeding upon opacity change</span>
            )
          )
        )
      }

      <span class="hljs-keyword">if</span> (o.shadow)
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt;= o.lines; i++)
          seg(i, -<span class="hljs-number">2</span>, <span class="hljs-string">'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)'</span>)

      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt;= o.lines; i++) seg(i)
      <span class="hljs-keyword">return</span> ins(el, g)
    }

    Spinner.prototype.opacity = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, val, o)</span> {</span>
      <span class="hljs-keyword">var</span> c = el.firstChild
      o = o.shadow &amp;&amp; o.lines || <span class="hljs-number">0</span>
      <span class="hljs-keyword">if</span> (c &amp;&amp; i+o &lt; c.childNodes.length) {
        c = c.childNodes[i+o]; c = c &amp;&amp; c.firstChild; c = c &amp;&amp; c.firstChild
        <span class="hljs-keyword">if</span> (c) c.opacity = val
      }
    }
  }

  <span class="hljs-keyword">var</span> probe = css(createEl(<span class="hljs-string">'group'</span>), {behavior: <span class="hljs-string">'url(#default#VML)'</span>})

  <span class="hljs-keyword">if</span> (!vendor(probe, <span class="hljs-string">'transform'</span>) &amp;&amp; probe.adj) initVML()
  <span class="hljs-keyword">else</span> useCssAnimations = vendor(probe, <span class="hljs-string">'animation'</span>)

  <span class="hljs-keyword">return</span> Spinner

}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
