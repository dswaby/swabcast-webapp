<!DOCTYPE html>

<html>
<head>
  <title>almond.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="SpecRunner.html">
                SpecRunner.js
              </a>
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="dialog.html">
                dialog.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="revealoptions.html">
                revealoptions.js
              </a>
            
              
              <a class="source" href="localstorage.html">
                localstorage.js
              </a>
            
              
              <a class="source" href="alert_controller.html">
                alert_controller.js
              </a>
            
              
              <a class="source" href="alert_view.html">
                alert_view.js
              </a>
            
              
              <a class="source" href="edit_controller.html">
                edit_controller.js
              </a>
            
              
              <a class="source" href="edit_view.html">
                edit_view.js
              </a>
            
              
              <a class="source" href="episodes_app.html">
                episodes_app.js
              </a>
            
              
              <a class="source" href="feed_controller.html">
                feed_controller.js
              </a>
            
              
              <a class="source" href="feed_view.html">
                feed_view.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="nav_controller.html">
                nav_controller.js
              </a>
            
              
              <a class="source" href="nav_view.html">
                nav_view.js
              </a>
            
              
              <a class="source" href="new_view.html">
                new_view.js
              </a>
            
              
              <a class="source" href="player_controller.html">
                player_controller.js
              </a>
            
              
              <a class="source" href="player_view.html">
                player_view.js
              </a>
            
              
              <a class="source" href="playlist_controller.html">
                playlist_controller.js
              </a>
            
              
              <a class="source" href="playlist_view.html">
                playlist_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="FeedSpec.html">
                FeedSpec.js
              </a>
            
              
              <a class="source" href="async.html">
                async.js
              </a>
            
              
              <a class="source" href="list_controller.html">
                list_controller.js
              </a>
            
              
              <a class="source" href="list_view.html">
                list_view.js
              </a>
            
              
              <a class="source" href="show_controller.html">
                show_controller.js
              </a>
            
              
              <a class="source" href="show_view.html">
                show_view.js
              </a>
            
              
              <a class="source" href="subscriptions_app.html">
                subscriptions_app.js
              </a>
            
              
              <a class="source" href="build.html">
                build.js
              </a>
            
              
              <a class="source" href="modal.html">
                modal.js
              </a>
            
              
              <a class="source" href="utils.html">
                utils.js
              </a>
            
              
              <a class="source" href="view.html">
                view.js
              </a>
            
              
              <a class="source" href="views.html">
                views.js
              </a>
            
              
              <a class="source" href="episode.html">
                episode.js
              </a>
            
              
              <a class="source" href="feed.html">
                feed.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
              
              <a class="source" href="playlist.html">
                playlist.js
              </a>
            
              
              <a class="source" href="subscriptions.html">
                subscriptions.js
              </a>
            
              
              <a class="source" href="topics.html">
                topics.js
              </a>
            
              
              <a class="source" href="require_main.html">
                require_main.js
              </a>
            
              
              <a class="source" href="require_main_built.html">
                require_main_built.js
              </a>
            
              
              <a class="source" href="almond.html">
                almond.js
              </a>
            
              
              <a class="source" href="backbone.babysitter.html">
                backbone.babysitter.js
              </a>
            
              
              <a class="source" href="backbone.html">
                backbone.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.html">
                backbone.localstorage.js
              </a>
            
              
              <a class="source" href="backbone.localstorage.min.html">
                backbone.localstorage.min.js
              </a>
            
              
              <a class="source" href="backbone.marionette.html">
                backbone.marionette.js
              </a>
            
              
              <a class="source" href="backbone.marionette.min.html">
                backbone.marionette.min.js
              </a>
            
              
              <a class="source" href="backbone.picky.html">
                backbone.picky.js
              </a>
            
              
              <a class="source" href="backbone.syphon.html">
                backbone.syphon.js
              </a>
            
              
              <a class="source" href="backbone.wreqr.html">
                backbone.wreqr.js
              </a>
            
              
              <a class="source" href="foundation.fastclick.html">
                foundation.fastclick.js
              </a>
            
              
              <a class="source" href="foundation.html">
                foundation.js
              </a>
            
              
              <a class="source" href="foundation.min.html">
                foundation.min.js
              </a>
            
              
              <a class="source" href="foundation.offcanvas.html">
                foundation.offcanvas.js
              </a>
            
              
              <a class="source" href="foundation.reveal.html">
                foundation.reveal.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jasmine-html.html">
                jasmine-html.js
              </a>
            
              
              <a class="source" href="jasmine.html">
                jasmine.js
              </a>
            
              
              <a class="source" href="jquery-ui-1.10.3.min.html">
                jquery-ui-1.10.3.min.js
              </a>
            
              
              <a class="source" href="jquery-ui.html">
                jquery-ui.js
              </a>
            
              
              <a class="source" href="jquery.html">
                jquery.js
              </a>
            
              
              <a class="source" href="jquery.transit.html">
                jquery.transit.js
              </a>
            
              
              <a class="source" href="jquery.transmit.html">
                jquery.transmit.js
              </a>
            
              
              <a class="source" href="json2.html">
                json2.js
              </a>
            
              
              <a class="source" href="log.html">
                log.js
              </a>
            
              
              <a class="source" href="modernizr.html">
                modernizr.js
              </a>
            
              
              <a class="source" href="require.html">
                require.js
              </a>
            
              
              <a class="source" href="jasmine-sinon.html">
                jasmine-sinon.js
              </a>
            
              
              <a class="source" href="sinon.html">
                sinon.js
              </a>
            
              
              <a class="source" href="spin.jquery.html">
                spin.jquery.js
              </a>
            
              
              <a class="source" href="spin.html">
                spin.js
              </a>
            
              
              <a class="source" href="tpl.html">
                tpl.js
              </a>
            
              
              <a class="source" href="underscore.html">
                underscore.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>almond.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Going sloppy to avoid ‘use strict’ string cost, but strict practices should
be followed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*jslint sloppy: true */</span>
<span class="hljs-comment">/*global setTimeout: false */</span>

<span class="hljs-keyword">var</span> requirejs, <span class="hljs-built_in">require</span>, define;
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(undef)</span> {</span>
    <span class="hljs-keyword">var</span> main, req, makeMap, handlers,
        defined = {},
        waiting = {},
        config = {},
        defining = {},
        hasOwn = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty,
        aps = [].slice;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasProp</span><span class="hljs-params">(obj, prop)</span> {</span>
        <span class="hljs-keyword">return</span> hasOwn.call(obj, prop);
    }

    <span class="hljs-comment">/**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalize</span><span class="hljs-params">(name, baseName)</span> {</span>
        <span class="hljs-keyword">var</span> nameParts, nameSegment, mapValue, foundMap,
            foundI, foundStarMap, starI, i, j, part,
            baseParts = baseName &amp;&amp; baseName.split(<span class="hljs-string">"/"</span>),
            map = config.map,
            starMap = (map &amp;&amp; map[<span class="hljs-string">'*'</span>]) || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Adjust any relative paths.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (name &amp;&amp; name.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"."</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>If have a base name, try to normalize against it,
otherwise, assume it is a top-level require that will
be relative to baseUrl in the end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (baseName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Convert baseName to array, and lop off the last part,
so that . matches that “directory” and not name of the baseName’s
module. For instance, baseName of “one/two/three”, maps to
“one/two/three.js”, but we want the directory, “one/two” for
this normalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                baseParts = baseParts.slice(<span class="hljs-number">0</span>, baseParts.length - <span class="hljs-number">1</span>);

                name = baseParts.concat(name.split(<span class="hljs-string">"/"</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>start trimDots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; name.length; i += <span class="hljs-number">1</span>) {
                    part = name[i];
                    <span class="hljs-keyword">if</span> (part === <span class="hljs-string">"."</span>) {
                        name.splice(i, <span class="hljs-number">1</span>);
                        i -= <span class="hljs-number">1</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (part === <span class="hljs-string">".."</span>) {
                        <span class="hljs-keyword">if</span> (i === <span class="hljs-number">1</span> &amp;&amp; (name[<span class="hljs-number">2</span>] === <span class="hljs-string">'..'</span> || name[<span class="hljs-number">0</span>] === <span class="hljs-string">'..'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>End of the line. Keep at least one non-dot
path segment at the front so it can be mapped
correctly to disk. Otherwise, there is likely
no path mapping for a path starting with ‘..’.
This can still fail, but catches the most reasonable
uses of ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">break</span>;
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
                            name.splice(i - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
                            i -= <span class="hljs-number">2</span>;
                        }
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>end trimDots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                name = name.join(<span class="hljs-string">"/"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name.indexOf(<span class="hljs-string">'./'</span>) === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>No baseName, so this is ID is resolved relative
to baseUrl, pull off the leading dot.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                name = name.substring(<span class="hljs-number">2</span>);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Apply map config if available.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((baseParts || starMap) &amp;&amp; map) {
            nameParts = name.split(<span class="hljs-string">'/'</span>);

            <span class="hljs-keyword">for</span> (i = nameParts.length; i &gt; <span class="hljs-number">0</span>; i -= <span class="hljs-number">1</span>) {
                nameSegment = nameParts.slice(<span class="hljs-number">0</span>, i).join(<span class="hljs-string">"/"</span>);

                <span class="hljs-keyword">if</span> (baseParts) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Find the longest baseName segment match in the config.
So, do joins on the biggest to smallest lengths of baseParts.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">for</span> (j = baseParts.length; j &gt; <span class="hljs-number">0</span>; j -= <span class="hljs-number">1</span>) {
                        mapValue = map[baseParts.slice(<span class="hljs-number">0</span>, j).join(<span class="hljs-string">'/'</span>)];</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>baseName segment has  config, find if it has one for
this name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (mapValue) {
                            mapValue = mapValue[nameSegment];
                            <span class="hljs-keyword">if</span> (mapValue) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Match, update name to the new value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                foundMap = mapValue;
                                foundI = i;
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                    }
                }

                <span class="hljs-keyword">if</span> (foundMap) {
                    <span class="hljs-keyword">break</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Check for a star map match, but just hold on to it,
if there is a shorter segment match later in a matching
config, then favor over this star map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!foundStarMap &amp;&amp; starMap &amp;&amp; starMap[nameSegment]) {
                    foundStarMap = starMap[nameSegment];
                    starI = i;
                }
            }

            <span class="hljs-keyword">if</span> (!foundMap &amp;&amp; foundStarMap) {
                foundMap = foundStarMap;
                foundI = starI;
            }

            <span class="hljs-keyword">if</span> (foundMap) {
                nameParts.splice(<span class="hljs-number">0</span>, foundI, foundMap);
                name = nameParts.join(<span class="hljs-string">'/'</span>);
            }
        }

        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeRequire</span><span class="hljs-params">(relName, forceSync)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>A version of a require function that passes a moduleName
value for items that may need to
look up paths relative to the moduleName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> req.apply(undef, aps.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">0</span>).concat([relName, forceSync]));
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeNormalize</span><span class="hljs-params">(relName)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> normalize(name, relName);
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeLoad</span><span class="hljs-params">(depName)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> {</span>
            defined[depName] = value;
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callDep</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">if</span> (hasProp(waiting, name)) {
            <span class="hljs-keyword">var</span> args = waiting[name];
            <span class="hljs-keyword">delete</span> waiting[name];
            defining[name] = <span class="hljs-literal">true</span>;
            main.apply(undef, args);
        }

        <span class="hljs-keyword">if</span> (!hasProp(defined, name) &amp;&amp; !hasProp(defining, name)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No '</span> + name);
        }
        <span class="hljs-keyword">return</span> defined[name];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Turns a plugin!resource to [plugin, resource]
with the plugin being undefined if the name
did not have a plugin prefix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitPrefix</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">var</span> prefix,
            index = name ? name.indexOf(<span class="hljs-string">'!'</span>) : -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
            prefix = name.substring(<span class="hljs-number">0</span>, index);
            name = name.substring(index + <span class="hljs-number">1</span>, name.length);
        }
        <span class="hljs-keyword">return</span> [prefix, name];
    }

    <span class="hljs-comment">/**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */</span>
    makeMap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, relName)</span> {</span>
        <span class="hljs-keyword">var</span> plugin,
            parts = splitPrefix(name),
            prefix = parts[<span class="hljs-number">0</span>];

        name = parts[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (prefix) {
            prefix = normalize(prefix, relName);
            plugin = callDep(prefix);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Normalize according</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (prefix) {
            <span class="hljs-keyword">if</span> (plugin &amp;&amp; plugin.normalize) {
                name = plugin.normalize(name, makeNormalize(relName));
            } <span class="hljs-keyword">else</span> {
                name = normalize(name, relName);
            }
        } <span class="hljs-keyword">else</span> {
            name = normalize(name, relName);
            parts = splitPrefix(name);
            prefix = parts[<span class="hljs-number">0</span>];
            name = parts[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (prefix) {
                plugin = callDep(prefix);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Using ridiculous property names for space reasons</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> {
            f: prefix ? prefix + <span class="hljs-string">'!'</span> + name : name, <span class="hljs-comment">//fullName</span>
            n: name,
            pr: prefix,
            p: plugin
        };
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeConfig</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> (config &amp;&amp; config.config &amp;&amp; config.config[name]) || {};
        };
    }

    handlers = {
        <span class="hljs-built_in">require</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> makeRequire(name);
        },
        exports: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">var</span> e = defined[name];
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> e !== <span class="hljs-string">'undefined'</span>) {
                <span class="hljs-keyword">return</span> e;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> (defined[name] = {});
            }
        },
        module: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name)</span> {</span>
            <span class="hljs-keyword">return</span> {
                id: name,
                uri: <span class="hljs-string">''</span>,
                exports: defined[name],
                config: makeConfig(name)
            };
        }
    };

    main = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, deps, callback, relName)</span> {</span>
        <span class="hljs-keyword">var</span> cjsModule, depName, ret, map, i,
            args = [],
            usingExports;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Use name if no relName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        relName = relName || name;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Call the callback to define the module, if necessary.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'function'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Pull out the defined dependencies and pass the ordered
values to the callback.
Default to [require, exports, module] if no deps</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            deps = !deps.length &amp;&amp; callback.length ? [<span class="hljs-string">'require'</span>, <span class="hljs-string">'exports'</span>, <span class="hljs-string">'module'</span>] : deps;
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; deps.length; i += <span class="hljs-number">1</span>) {
                map = makeMap(deps[i], relName);
                depName = map.f;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Fast path CommonJS standard dependencies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"require"</span>) {
                    args[i] = handlers.require(name);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"exports"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>CommonJS module spec 1.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    args[i] = handlers.exports(name);
                    usingExports = <span class="hljs-literal">true</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (depName === <span class="hljs-string">"module"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>CommonJS module spec 1.1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    cjsModule = args[i] = handlers.module(name);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasProp(defined, depName) ||
                           hasProp(waiting, depName) ||
                           hasProp(defining, depName)) {
                    args[i] = callDep(depName);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (map.p) {
                    map.p.load(map.n, makeRequire(relName, <span class="hljs-literal">true</span>), makeLoad(depName), {});
                    args[i] = defined[depName];
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(name + <span class="hljs-string">' missing '</span> + depName);
                }
            }

            ret = callback.apply(defined[name], args);

            <span class="hljs-keyword">if</span> (name) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>If setting exports via “module” is in play,
favor that over return value and exports. After that,
favor a non-undefined return value over exports use.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cjsModule &amp;&amp; cjsModule.exports !== undef &amp;&amp;
                        cjsModule.exports !== defined[name]) {
                    defined[name] = cjsModule.exports;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret !== undef || !usingExports) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Use the return value from the function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    defined[name] = ret;
                }
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>May just be an object definition for the module. Only
worry about defining if have a module name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            defined[name] = callback;
        }
    };

    requirejs = <span class="hljs-built_in">require</span> = req = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(deps, callback, relName, forceSync, alt)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> deps === <span class="hljs-string">"string"</span>) {
            <span class="hljs-keyword">if</span> (handlers[deps]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>callback in this case is really relName</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">return</span> handlers[deps](callback);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Just return the module wanted. In this scenario, the
deps arg is the module name, and second arg (if passed)
is just the relName.
Normalize module name, if it contains . or ..</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> callDep(makeMap(deps, callback).f);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!deps.splice) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>deps is a config object, not an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            config = deps;
            <span class="hljs-keyword">if</span> (callback.splice) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>callback is an array, which means it is a dependency list.
Adjust args if there are dependencies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                deps = callback;
                callback = relName;
                relName = <span class="hljs-literal">null</span>;
            } <span class="hljs-keyword">else</span> {
                deps = undef;
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Support require([‘a’])</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        callback = callback || <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>If relName is a function, it is an errback handler,
so remove it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> relName === <span class="hljs-string">'function'</span>) {
            relName = forceSync;
            forceSync = alt;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Simulate async callback;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (forceSync) {
            main(undef, deps, callback, relName);
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Using a non-zero value because of concern for what old browsers
do, and latest browsers “upgrade” to 4 if lower value is used:
<a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout">http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout</a>:
If want a value immediately, use require(‘id’) instead — something
that works in almond on the global level, but not guaranteed and
unlikely to work in other AMD implementations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
                main(undef, deps, callback, relName);
            }, <span class="hljs-number">4</span>);
        }

        <span class="hljs-keyword">return</span> req;
    };

    <span class="hljs-comment">/**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */</span>
    req.config = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(cfg)</span> {</span>
        config = cfg;
        <span class="hljs-keyword">if</span> (config.deps) {
            req(config.deps, config.callback);
        }
        <span class="hljs-keyword">return</span> req;
    };

    <span class="hljs-comment">/**
     * Expose module registry for debugging and tooling
     */</span>
    requirejs._defined = defined;

    define = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, deps, callback)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>This module may not have dependencies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!deps.splice) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>deps is not an array, so probably means
an object literal or factory function for
the value. Adjust args.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            callback = deps;
            deps = [];
        }

        <span class="hljs-keyword">if</span> (!hasProp(defined, name) &amp;&amp; !hasProp(waiting, name)) {
            waiting[name] = [name, deps, callback];
        }
    };

    define.amd = {
        jQuery: <span class="hljs-literal">true</span>
    };
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
